<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">x</span>,<span class="var type1" id="S3T1U4">P</span>]= EKF_predict(<span class="mxinfo " id="T2:U3"><span class="mxinfo " id="T2:U4"><span class="var type1" id="S2T2U7">x</span></span></span>,<span class="mxinfo " id="T1:U6"><span class="mxinfo " id="T1:U7"><span class="var type1" id="S3T1U8">P</span></span></span>,<span class="var type1" id="S4T3U9">v</span>,<span class="var type1" id="S5T3U10">g</span>,<span class="var type1" id="S6T12U11">Q</span>,<span class="var type1" id="S7T3U12">dt</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%function [xn,Pn]= predict (x,P,v,g,Q,WB,dt)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% Inputs:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%   x, P - state and covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%   v, g - control inputs: velocity and gamma (steer angle)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%   Q - covariance matrix for velocity and gamma</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   dt - timestep</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Outputs: </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="comment">%   x, P - predicted state and covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="comment">% &lt;------------------------- TO DO --------------------------&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"> <span class="mxinfo " id="T1:U13"><span class="var type1" id="S8T1U15">J</span> = <span class="mxinfo " id="T1:U15">[<span class="mxinfo " id="T42:U16"><span class="mxinfo " id="T3:U17">1</span>, <span class="mxinfo " id="T3:U18">0</span>, <span class="mxinfo " id="T3:U19"><span class="mxinfo " id="T3:U20"><span class="mxinfo " id="T3:U21">-<span class="var type1" id="S4T3U23">v</span></span>*<span class="var type1" id="S7T3U24">dt</span></span>*<span class="mxinfo " id="T3:U24">sin(<span class="mxinfo " id="T3:U25"><span class="var type1" id="S5T3U28">g</span> + <span class="mxinfo " id="T3:U27"><span class="var type1" id="S2T2U30">x</span>(<span class="mxinfo " id="T3:U29">3</span>)</span></span>)</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T1:U13"><span class="mxinfo " id="T1:U15">       <span class="mxinfo " id="T42:U30"><span class="mxinfo " id="T3:U31">0</span>, <span class="mxinfo " id="T3:U32">1</span>, <span class="mxinfo " id="T3:U33"><span class="mxinfo " id="T3:U34"><span class="var type1" id="S4T3U37">v</span>*<span class="var type1" id="S7T3U38">dt</span></span>*<span class="mxinfo " id="T3:U37">cos(<span class="mxinfo " id="T3:U38"><span class="var type1" id="S5T3U42">g</span> + <span class="mxinfo " id="T3:U40"><span class="var type1" id="S2T2U44">x</span>(<span class="mxinfo " id="T3:U42">3</span>)</span></span>)</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T1:U13"><span class="mxinfo " id="T1:U15">       <span class="mxinfo " id="T42:U43"><span class="mxinfo " id="T3:U44">0</span>, <span class="mxinfo " id="T3:U45">0</span>, <span class="mxinfo " id="T3:U46">1</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"> <span class="mxinfo " id="T11:U47"><span class="var type1" id="S11T11U52">M</span> = <span class="mxinfo " id="T11:U49">[<span class="mxinfo " id="T39:U50"><span class="mxinfo " id="T3:U51"><span class="var type1" id="S7T3U56">dt</span>*<span class="mxinfo " id="T3:U53">cos(<span class="mxinfo " id="T3:U54"><span class="var type1" id="S5T3U60">g</span> + <span class="mxinfo " id="T3:U56"><span class="var type1" id="S2T2U62">x</span>(<span class="mxinfo " id="T3:U58">3</span>)</span></span>)</span></span>,<span class="mxinfo " id="T3:U59"><span class="mxinfo " id="T3:U60"><span class="mxinfo " id="T3:U61">-<span class="var type1" id="S4T3U67">v</span></span>*<span class="var type1" id="S7T3U68">dt</span></span>*<span class="mxinfo " id="T3:U64">sin(<span class="mxinfo " id="T3:U65"><span class="var type1" id="S5T3U72">g</span> + <span class="mxinfo " id="T3:U67"><span class="var type1" id="S2T2U74">x</span>(<span class="mxinfo " id="T3:U69">3</span>)</span></span>)</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T11:U47"><span class="mxinfo " id="T11:U49">      <span class="mxinfo " id="T39:U70"><span class="mxinfo " id="T3:U71"><span class="var type1" id="S7T3U78">dt</span>*<span class="mxinfo " id="T3:U73">sin(<span class="mxinfo " id="T3:U74"><span class="var type1" id="S5T3U82">g</span> + <span class="mxinfo " id="T3:U76"><span class="var type1" id="S2T2U84">x</span>(<span class="mxinfo " id="T3:U78">3</span>)</span></span>)</span></span>,<span class="mxinfo " id="T3:U79"><span class="mxinfo " id="T3:U80"><span class="var type1" id="S4T3U88">v</span>*<span class="var type1" id="S7T3U89">dt</span></span>*<span class="mxinfo " id="T3:U83">cos(<span class="mxinfo " id="T3:U84"><span class="var type1" id="S5T3U93">g</span> + <span class="mxinfo " id="T3:U86"><span class="var type1" id="S2T2U95">x</span>(<span class="mxinfo " id="T3:U88">3</span>)</span></span>)</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T11:U47"><span class="mxinfo " id="T11:U49">      <span class="mxinfo " id="T39:U89"><span class="mxinfo " id="T3:U90">0</span>,<span class="mxinfo " id="T3:U91">1</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"> <span class="mxinfo " id="T1:U92"><span class="var type1" id="S3T1U102">P</span> = <span class="mxinfo " id="T1:U94"><span class="mxinfo " id="T1:U95"><span class="mxinfo " id="T1:U96"><span class="var type1" id="S8T1U106">J</span> * <span class="var type1" id="S3T1U107">P</span></span> * <span class="mxinfo " id="T1:U99"><span class="var type1" id="S8T1U109">J</span>'</span></span> + <span class="mxinfo " id="T1:U101"><span class="mxinfo " id="T11:U102"><span class="var type1" id="S11T11U112">M</span> * <span class="var type1" id="S6T12U113">Q</span></span> * <span class="mxinfo " id="T13:U105"><span class="var type1" id="S11T11U115">M</span>'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"> <span class="mxinfo " id="T3:U107"><span class="mxinfo " id="T3:U108"><span class="var type1" id="S2T2U119">x</span>(1)</span> = <span class="mxinfo " id="T3:U110"><span class="mxinfo " id="T3:U111"><span class="var type1" id="S2T2U123">x</span>(<span class="mxinfo " id="T3:U113">1</span>)</span> + <span class="mxinfo " id="T3:U114"><span class="mxinfo " id="T3:U115"><span class="var type1" id="S4T3U127">v</span> * <span class="var type1" id="S7T3U128">dt</span></span> * <span class="mxinfo " id="T3:U118">cos(<span class="mxinfo " id="T3:U119"><span class="var type1" id="S5T3U132">g</span> + <span class="mxinfo " id="T3:U121"><span class="var type1" id="S2T2U134">x</span>(<span class="mxinfo " id="T3:U123">3</span>)</span></span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"> <span class="mxinfo " id="T3:U124"><span class="mxinfo " id="T3:U125"><span class="var type1" id="S2T2U139">x</span>(2)</span> = <span class="mxinfo " id="T3:U127"><span class="mxinfo " id="T3:U128"><span class="var type1" id="S2T2U143">x</span>(<span class="mxinfo " id="T3:U130">2</span>)</span> + <span class="mxinfo " id="T3:U131"><span class="mxinfo " id="T3:U132"><span class="var type1" id="S4T3U147">v</span> * <span class="var type1" id="S7T3U148">dt</span></span> * <span class="mxinfo " id="T3:U135">sin(<span class="mxinfo " id="T3:U136"><span class="var type1" id="S5T3U152">g</span> + <span class="mxinfo " id="T3:U138"><span class="var type1" id="S2T2U154">x</span>(<span class="mxinfo " id="T3:U140">3</span>)</span></span>)</span></span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"> <span class="mxinfo " id="T3:U141"><span class="mxinfo " id="T3:U142"><span class="var type1" id="S2T2U159">x</span>(<span class="mxinfo " id="T3:U144">3</span>)</span> = <span class="mxinfo " id="T3:U145"><span class="fcn" id="F87N4:B162">pi_to_pi</span>(<span class="mxinfo " id="T3:U146"><span class="mxinfo " id="T3:U147"><span class="var type1" id="S2T2U165">x</span>(3)</span> + <span class="var type1" id="S5T3U167">g</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"> </span></span>
</pre>
